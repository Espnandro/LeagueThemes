const utils=require("./_utilsMinify");let previous_page,ranked_observer,default_settings=require("./configs/HuTaoMinify_config.json"),patcher_go_to_default_home_page=!0,force_bg_pause=default_settings.default_animated,force_audio_pause=default_settings.default_sound_autoplay,wallpapers=default_settings.wallpaper_list;function apply_default_background(){let a=default_settings.default_wallpaper,b=wallpapers.indexOf(a);-1!==b&&(wallpapers.splice(b,1),wallpapers.unshift(a))}apply_default_background();function removeIframe(){const a=new MutationObserver(a=>{a.forEach(a=>{"childList"===a.type&&a.addedNodes.forEach(a=>{if("IFRAME"===a.tagName&&a.hasAttribute("src")&&a.hasAttribute("referrerpolicy"));})})});a.observe(document.body,{childList:!0,subtree:!0})}var nodeRemovedEvent=function(a){if(a.target.classList&&a.target.classList.contains("lol-loading-screen-container")){let a=document.getElementById("hutao-bg"),b=document.getElementById("rcp-fe-viewport-root");b.style.filter="none",a.style.filter="brightness(0.7) saturate(0.8)",document.removeEventListener("DOMNodeRemoved",nodeRemovedEvent)}};document.addEventListener("DOMNodeRemoved",nodeRemovedEvent);let updateLobbyRegaliaBanner=async a=>{let b=JSON.parse(a.data)[2].data;if("Lobby"==b){let a=window.setInterval(()=>{try{let a=document.querySelector("lol-regalia-parties-v2-element.regalia-loaded").shadowRoot.querySelector(".regalia-parties-v2-banner-backdrop.regalia-banner-loaded");a.shadowRoot.querySelector(".regalia-banner-asset-static-image").style.filter="sepia(1) brightness(3.5) opacity(0.4)",a.shadowRoot.querySelector(".regalia-banner-state-machine").shadowRoot.querySelector(".regalia-banner-intro.regalia-banner-video").style.filter="grayscale(1) saturate(0) brightness(0.5)"}catch{return}window.clearInterval(a)},100)}};function hutao_play_pause(){let a=document.getElementById("hutao-bg");force_bg_pause?a.pause():a.play()}function audio_play_pause(){let a=document.getElementById("bg-audio");force_audio_pause?a.play():a.pause()}function play_pause_set_icon(a){let b=a||document.querySelector(".pause-bg-icon");b&&(force_bg_pause?b.setAttribute("src","//assets/HuTao/Icon/play_button.png"):b.setAttribute("src","//assets/HuTao/Icon/pause_button.png"))}function play_pause_set_icon_audio(a){let b=a||document.querySelector(".pause-audio-icon");b&&(force_audio_pause?b.setAttribute("src","//assets/HuTao/Icon/mute.png"):b.setAttribute("src","//assets/HuTao/Icon/audio.png"))}function next_wallpaper(){let a=document.getElementById("hutao-bg");document.querySelector(":root").classList.remove(wallpapers[0].replace(/\.[a-zA-Z]+$/,"-vars")),a.classList.add("webm-hidden"),wallpapers.push(wallpapers.shift()),document.querySelector(":root").classList.add(wallpapers[0].replace(/\.[a-zA-Z]+$/,"-vars")),setTimeout(function(){a.src=`//assets/HuTao/Backgrounds/${wallpapers[0]}`,hutao_play_pause(),a.classList.remove("webm-hidden")},500)}function create_webm_buttons(){const a=document.createElement("div"),b=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("img"),f=document.createElement("img"),g=document.createElement("img");a.classList.add("webm-bottom-buttons-container"),b.id="pause-bg",d.id="next-bg",c.id="pause-audio",f.classList.add("next-bg-icon"),e.classList.add("pause-bg-icon"),g.classList.add("pause-audio-icon"),play_pause_set_icon_audio(g),c.addEventListener("click",()=>{force_audio_pause=!force_audio_pause,audio_play_pause(),play_pause_set_icon_audio()}),play_pause_set_icon(e),b.addEventListener("click",()=>{force_bg_pause=!force_bg_pause,hutao_play_pause(),play_pause_set_icon()}),d.addEventListener("click",()=>{next_wallpaper()}),f.setAttribute("src","//assets/HuTao/Icon/next_button.png"),document.getElementsByClassName("rcp-fe-lol-home")[0].appendChild(a),a.append(b),a.append(d),a.append(c),b.append(e),d.append(f),c.append(g)}function create_element(a,b,c){const d=document.createElement(a);return d.className=b,c&&(d.innerHTML=c),d}function go_to_default_home_page(){default_settings.default_home_page&&document.querySelector(`lol-uikit-navigation-item[item-id='${default_settings.default_home_page}']`).click()}function add_hutao_home_page(){let a=document.querySelector(".rcp-fe-lol-home > lol-uikit-section-controller");if(a&&!a.querySelector("[section-id='hutao-home']")){let b=create_element("lol-uikit-section",""),c=create_element("div","wrapper");c.id="hutao-home",b.setAttribute("section-id","hutao-home"),b.append(c),a.prepend(b)}}function add_hutao_home_navbar(){let a=document.querySelector(".rcp-fe-lol-home > lol-uikit-navigation-bar");if(a&&!a.querySelector("[item-id='hutao-home']")){let b=create_element("lol-uikit-navigation-item","");b.setAttribute("item-id","hutao-home"),b.setAttribute("priority",1),b.textContent="Hu Tao theme by Rumi",a.prepend(b)}}let pageChangeMutation=a=>{let b,c=document.getElementById("hutao-bg"),d=["rcp-fe-lol-champ-select","rcp-fe-lol-store","rcp-fe-lol-collections","rcp-fe-lol-profiles-main","rcp-fe-lol-parties","rcp-fe-lol-loot","rcp-fe-lol-clash-full"];if(b=a.getAttribute("data-screen-name"),console.log(b),"rcp-fe-lol-home-main"==b?(!document.getElementsByClassName("webm-bottom-buttons-container").length&&create_webm_buttons(),add_hutao_home_page(),add_hutao_home_navbar(),go_to_default_home_page()):"rcp-fe-lol-navigation-screen"!=b&&"window-controls"!=b&&"rcp-fe-lol-home"!=b&&"social"!=b&&document.getElementsByClassName("webm-bottom-buttons-container").length&&document.getElementsByClassName("webm-bottom-buttons-container")[0].remove(),"social"==b&&patcher_go_to_default_home_page&&(go_to_default_home_page(),patcher_go_to_default_home_page=!1),"rcp-fe-lol-uikit-full-page-modal-controller"!=b){if("rcp-fe-lol-champ-select"==b?c.style.filter="blur(3px) brightness(0.4) saturate(1.5)":"rcp-fe-lol-champ-select"==previous_page&&-1==d.indexOf(b)&&(c.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-clash-full"==b?c.style.filter="blur(10px) brightness(0.2)":"rcp-fe-lol-clash-full"==previous_page&&-1==d.indexOf(b)&&(c.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-loot"==b?c.style.filter="brightness(0.3)":"rcp-fe-lol-loot"==previous_page&&-1==d.indexOf(b)&&(c.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-store"==b?c.style.filter="brightness(0.2)":"rcp-fe-lol-store"==previous_page&&-1==d.indexOf(b)&&(c.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-collections"==b?c.style.filter="brightness(0.2)":"rcp-fe-lol-collections"==previous_page&&-1==d.indexOf(b)&&(c.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-profiles-main"==b){let a=document.querySelector("[section-id=\"profile_subsection_leagues\"]");!ranked_observer&&a&&(ranked_observer=new MutationObserver(a=>{a.forEach(a=>{if(a.target.classList.contains("visible")){let a=window.setInterval(()=>{try{document.querySelector("div.smoke-background-container > lol-uikit-parallax-background").shadowRoot.querySelector(".parallax-layer-container").style.backgroundImage="",window.clearInterval(a)}catch{}},50)}})}),ranked_observer.observe(document.querySelector("[section-id=\"profile_subsection_leagues\"]"),{attributes:!0,childList:!1,subtree:!1})),c.style.filter=bg_filters["rcp-fe-lol-profiles-main"][wallpapers[0]]}else"rcp-fe-lol-profiles-main"==previous_page&&(-1==d.indexOf(b)&&(c.style.filter="brightness(0.7) saturate(0.8)"),ranked_observer&&ranked_observer.disconnect(),ranked_observer=void 0);"rcp-fe-lol-parties"==b?c.style.filter=bg_filters["rcp-fe-lol-parties"][wallpapers[0]]:"rcp-fe-lol-parties"==previous_page&&-1==d.indexOf(b)&&(c.style.filter=bg_filters["default"][wallpapers[0]]),previous_page!=b&&(previous_page=b)}};window.addEventListener("load",()=>{utils.mutationObserverAddCallback(pageChangeMutation,["screen-root"])}),window.addEventListener("DOMContentLoaded",()=>{const a=document.createElement("video");a.id="hutao-bg",a.setAttribute("autoplay",""),a.setAttribute("loop",""),a.setAttribute("muted",""),a.src=default_settings.default_wallpaper_src,utils.subscribe_endpoint("/lol-gameflow/v1/gameflow-phase",updateLobbyRegaliaBanner),utils.addCss(default_settings.css_file);const b=default_settings.audio_src,c=document.createElement("audio");c.id="bg-audio",c.autoplay=default_settings.default_sound_autoplay,c.loop=!0,c.volume=default_settings.default_sound_volume,c.src=b,c.load(),c.addEventListener("load",function(){c.play()},!0),document.querySelector("body").prepend(a),document.querySelector("body").prepend(c),hutao_play_pause(),utils.subscribe_endpoint("/lol-gameflow/v1/gameflow-phase",a=>{let b=JSON.parse(a.data)[2].data;"GameStart"==b||"InProgress"==b?(document.getElementById("hutao-bg").style.filter="blur(2px) brightness(0.4) saturate(1.5)",document.getElementById("hutao-bg").pause(),document.getElementById("bg-audio").pause()):(hutao_play_pause(),audio_play_pause())}),console.clear()});