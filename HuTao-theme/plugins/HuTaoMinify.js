const utils=require("./_utilsMinify");let previous_page,ranked_observer,default_settings=require("./configs/HuTaoMinify_config.json"),patcher_go_to_default_home_page=!0,force_bg_pause=default_settings.default_animated,force_audio_pause=default_settings.default_sound_autoplay,wallpapers=default_settings.wallpaper_list;function apply_default_background(){let e=default_settings.default_wallpaper,t=wallpapers.indexOf(e);-1!==t&&(wallpapers.splice(t,1),wallpapers.unshift(e))}function removeIframe(){new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{"IFRAME"===e.tagName&&e.hasAttribute("src")&&e.hasAttribute("referrerpolicy")}))}))})).observe(document.body,{childList:!0,subtree:!0})}apply_default_background();var nodeRemovedEvent=function(e){if(e.target.classList&&e.target.classList.contains("lol-loading-screen-container")){let e=document.getElementById("hutao-bg");document.getElementById("rcp-fe-viewport-root").style.filter="none",e.style.filter="brightness(0.7) saturate(0.8)",document.removeEventListener("DOMNodeRemoved",nodeRemovedEvent)}};document.addEventListener("DOMNodeRemoved",nodeRemovedEvent);let updateLobbyRegaliaBanner=async e=>{if("Lobby"==JSON.parse(e.data)[2].data){let e=window.setInterval((()=>{try{let e=document.querySelector("lol-regalia-parties-v2-element.regalia-loaded").shadowRoot.querySelector(".regalia-parties-v2-banner-backdrop.regalia-banner-loaded");e.shadowRoot.querySelector(".regalia-banner-asset-static-image").style.filter="sepia(1) brightness(3.5) opacity(0.4)",e.shadowRoot.querySelector(".regalia-banner-state-machine").shadowRoot.querySelector(".regalia-banner-intro.regalia-banner-video").style.filter="grayscale(1) saturate(0) brightness(0.5)"}catch{return}window.clearInterval(e)}),100)}};function hutao_play_pause(){let e=document.getElementById("hutao-bg");force_bg_pause?e.pause():e.play()}function audio_play_pause(){let e=document.getElementById("bg-audio");force_audio_pause?e.play():e.pause()}function play_pause_set_icon(e){let t=e||document.querySelector(".pause-bg-icon");t&&(force_bg_pause?t.setAttribute("src","//assets/HuTao/Icon/play_button.png"):t.setAttribute("src","//assets/HuTao/Icon/pause_button.png"))}function play_pause_set_icon_audio(e){let t=e||document.querySelector(".pause-audio-icon");t&&(force_audio_pause?t.setAttribute("src","//assets/HuTao/Icon/mute.png"):t.setAttribute("src","//assets/HuTao/Icon/audio.png"))}function next_wallpaper(){let e=document.getElementById("hutao-bg");document.querySelector(":root").classList.remove(wallpapers[0].replace(/\.[a-zA-Z]+$/,"-vars")),e.classList.add("webm-hidden"),wallpapers.push(wallpapers.shift()),document.querySelector(":root").classList.add(wallpapers[0].replace(/\.[a-zA-Z]+$/,"-vars")),setTimeout((function(){e.src=`//assets/HuTao/Backgrounds/${wallpapers[0]}`,hutao_play_pause(),e.classList.remove("webm-hidden")}),500)}function create_webm_buttons(){const e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),l=document.createElement("img"),s=document.createElement("img"),r=document.createElement("img");e.classList.add("webm-bottom-buttons-container"),t.id="pause-bg",o.id="next-bg",a.id="pause-audio",s.classList.add("next-bg-icon"),l.classList.add("pause-bg-icon"),r.classList.add("pause-audio-icon"),play_pause_set_icon_audio(r),a.addEventListener("click",(()=>{force_audio_pause=!force_audio_pause,audio_play_pause(),play_pause_set_icon_audio()})),play_pause_set_icon(l),t.addEventListener("click",(()=>{force_bg_pause=!force_bg_pause,hutao_play_pause(),play_pause_set_icon()})),o.addEventListener("click",(()=>{next_wallpaper()})),s.setAttribute("src","//assets/HuTao/Icon/next_button.png"),document.getElementsByClassName("rcp-fe-lol-home")[0].appendChild(e),e.append(t),e.append(a),e.append(o),t.append(l),a.append(r),o.append(s)}function create_element(e,t,a){const o=document.createElement(e);return o.className=t,a&&(o.innerHTML=a),o}function go_to_default_home_page(){default_settings.default_home_page&&document.querySelector(`lol-uikit-navigation-item[item-id='${default_settings.default_home_page}']`).click()}function add_hutao_home_page(){let e=document.querySelector(".rcp-fe-lol-home > lol-uikit-section-controller");if(e&&!e.querySelector("[section-id='hutao-home']")){let t=create_element("lol-uikit-section",""),a=create_element("div","wrapper");a.id="hutao-home",t.setAttribute("section-id","hutao-home"),t.append(a),e.prepend(t)}}function add_hutao_home_navbar(){let e=document.querySelector(".rcp-fe-lol-home > lol-uikit-navigation-bar");if(e&&!e.querySelector("[item-id='hutao-home']")){let t=create_element("lol-uikit-navigation-item","");t.setAttribute("item-id","hutao-home"),t.setAttribute("priority",1),t.textContent="Hu Tao theme by Rumi",e.prepend(t)}}let pageChangeMutation=e=>{let t,a=document.getElementById("hutao-bg"),o=["rcp-fe-lol-champ-select","rcp-fe-lol-store","rcp-fe-lol-collections","rcp-fe-lol-profiles-main","rcp-fe-lol-parties","rcp-fe-lol-loot","rcp-fe-lol-clash-full"];if(t=e.getAttribute("data-screen-name"),console.log(t),"rcp-fe-lol-home-main"==t?(document.getElementsByClassName("webm-bottom-buttons-container").length||create_webm_buttons(),add_hutao_home_page(),add_hutao_home_navbar(),go_to_default_home_page()):"rcp-fe-lol-navigation-screen"!=t&&"window-controls"!=t&&"rcp-fe-lol-home"!=t&&"social"!=t&&document.getElementsByClassName("webm-bottom-buttons-container").length&&document.getElementsByClassName("webm-bottom-buttons-container")[0].remove(),"social"==t&&patcher_go_to_default_home_page&&(go_to_default_home_page(),patcher_go_to_default_home_page=!1),"rcp-fe-lol-uikit-full-page-modal-controller"!=t){if("rcp-fe-lol-champ-select"==t?a.style.filter="blur(3px) brightness(0.4) saturate(1.5)":"rcp-fe-lol-champ-select"==previous_page&&-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-clash-full"==t?a.style.filter="blur(10px) brightness(0.2)":"rcp-fe-lol-clash-full"==previous_page&&-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-loot"==t?a.style.filter="brightness(0.3)":"rcp-fe-lol-loot"==previous_page&&-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-store"==t?a.style.filter="brightness(0.2)":"rcp-fe-lol-store"==previous_page&&-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-collections"==t?a.style.filter="brightness(0.2)":"rcp-fe-lol-collections"==previous_page&&-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-yourshop"==t?a.style.filter="brightness(0.3)":"rcp-fe-lol-yourshop"==previous_page&&-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),"rcp-fe-lol-profiles-main"==t){let e=document.querySelector('[section-id="profile_subsection_leagues"]');!ranked_observer&&e&&(ranked_observer=new MutationObserver((e=>{e.forEach((e=>{if(e.target.classList.contains("visible")){let e=window.setInterval((()=>{try{document.querySelector("div.smoke-background-container > lol-uikit-parallax-background").shadowRoot.querySelector(".parallax-layer-container").style.backgroundImage="",window.clearInterval(e)}catch{}}),50)}}))})),ranked_observer.observe(document.querySelector('[section-id="profile_subsection_leagues"]'),{attributes:!0,childList:!1,subtree:!1})),a.style.filter=bg_filters["rcp-fe-lol-profiles-main"][wallpapers[0]]}else"rcp-fe-lol-profiles-main"==previous_page&&(-1==o.indexOf(t)&&(a.style.filter="brightness(0.7) saturate(0.8)"),ranked_observer&&ranked_observer.disconnect(),ranked_observer=void 0);"rcp-fe-lol-parties"==t?a.style.filter=bg_filters["rcp-fe-lol-parties"][wallpapers[0]]:"rcp-fe-lol-parties"==previous_page&&-1==o.indexOf(t)&&(a.style.filter=bg_filters.default[wallpapers[0]]),previous_page!=t&&(previous_page=t)}};window.addEventListener("load",(()=>{utils.mutationObserverAddCallback(pageChangeMutation,["screen-root"])})),window.addEventListener("DOMContentLoaded",(()=>{const e=document.createElement("video");e.id="hutao-bg",e.setAttribute("autoplay",""),e.setAttribute("loop",""),e.setAttribute("muted",""),e.src=default_settings.default_wallpaper_src,utils.subscribe_endpoint("/lol-gameflow/v1/gameflow-phase",updateLobbyRegaliaBanner),utils.addCss(default_settings.css_file);const t=default_settings.audio_src,a=document.createElement("audio");a.id="bg-audio",a.autoplay=default_settings.default_sound_autoplay,a.loop=!0,a.volume=default_settings.default_sound_volume,a.src=t,a.load(),a.addEventListener("load",(function(){a.play()}),!0),document.querySelector("body").prepend(e),document.querySelector("body").prepend(a),hutao_play_pause(),utils.subscribe_endpoint("/lol-gameflow/v1/gameflow-phase",(e=>{let t=JSON.parse(e.data)[2].data;"GameStart"==t||"InProgress"==t?(document.getElementById("hutao-bg").style.filter="blur(2px) brightness(0.4) saturate(1.5)",document.getElementById("hutao-bg").pause(),document.getElementById("bg-audio").pause()):(hutao_play_pause(),audio_play_pause())})),console.clear()}));